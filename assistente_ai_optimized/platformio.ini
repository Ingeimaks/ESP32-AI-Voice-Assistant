[env:esp32-s3-devkitc-1]
platform = espressif32@^6.4.0
board = esp32-s3-devkitc-1
framework = arduino

; ==== CONFIGURAZIONE OTTIMIZZATA ESP32-S3 ====

; Configurazione Flash e PSRAM
board_build.flash_size = 16MB
board_build.psram_type = opi
board_build.memory_type = opi_opi

; Partizioni ottimizzate per 16MB Flash
board_build.partitions = huge_app.csv

; Configurazione CPU e Clock
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L
board_build.flash_mode = qio

; Ottimizzazioni compilatore per prestazioni
build_flags = 
    -DCORE_DEBUG_LEVEL=1
    -DCONFIG_ARDUHAL_LOG_DEFAULT_LEVEL=1
    ; Ottimizzazioni CPU
    -DCONFIG_ESP32S3_DEFAULT_CPU_FREQ_240=1
    -DCONFIG_ESP32S3_SPIRAM_SUPPORT=1
    ; Ottimizzazioni PSRAM
    -DCONFIG_SPIRAM_USE_CAPS_ALLOC=1
    -DCONFIG_SPIRAM_USE_MALLOC=1
    -DCONFIG_SPIRAM_MALLOC_ALWAYSINTERNAL=0
    -DCONFIG_SPIRAM_MALLOC_RESERVE_INTERNAL=32768
    ; Ottimizzazioni WiFi
    -DCONFIG_ESP32_WIFI_DYNAMIC_RX_BUFFER_NUM=32
    -DCONFIG_ESP32_WIFI_DYNAMIC_TX_BUFFER_NUM=32
    -DCONFIG_ESP32_WIFI_AMPDU_TX_ENABLED=1
    -DCONFIG_ESP32_WIFI_AMPDU_RX_ENABLED=1
    ; Ottimizzazioni I2S
    -DCONFIG_I2S_SUPPRESS_DEPRECATE_WARN=1
    ; Ottimizzazioni FreeRTOS
    -DCONFIG_FREERTOS_HZ=1000
    -DCONFIG_ESP_TASK_WDT_TIMEOUT_S=10
    ; Ottimizzazioni memoria
    -DCONFIG_ESP_SYSTEM_ALLOW_RTC_FAST_MEM_AS_HEAP=1
    ; Compilazione ottimizzata
    -O3
    -ffast-math
    -funroll-loops
    -ftree-vectorize

; Librerie richieste
lib_deps = 
    adafruit/Adafruit VL53L0X@^1.3.0
    bblanchon/ArduinoJson@^6.21.3
    Wire
    WiFi
    WiFiClientSecure

; Configurazione monitor seriale
monitor_speed = 115200
monitor_filters = 
    esp32_exception_decoder
    time

; Configurazione upload
upload_speed = 921600
upload_port = COM*

; ==== CONFIGURAZIONI ALTERNATIVE ====

; Configurazione per debug (più lenta ma con più info)
[env:esp32-s3-debug]
platform = espressif32@^6.4.0
board = esp32-s3-devkitc-1
framework = arduino
board_build.flash_size = 16MB
board_build.psram_type = opi
board_build.memory_type = opi_opi
board_build.partitions = huge_app.csv
build_flags = 
    -DCORE_DEBUG_LEVEL=4
    -DCONFIG_ARDUHAL_LOG_DEFAULT_LEVEL=4
    -DCONFIG_ESP32S3_SPIRAM_SUPPORT=1
    -DCONFIG_SPIRAM_USE_CAPS_ALLOC=1
    -g
    -O0
lib_deps = 
    adafruit/Adafruit VL53L0X@^1.3.0
    bblanchon/ArduinoJson@^6.21.3
    Wire
    WiFi
    WiFiClientSecure
monitor_speed = 115200
monitor_filters = 
    esp32_exception_decoder
    time
    log2file

; Configurazione per produzione (ottimizzazioni massime)
[env:esp32-s3-release]
platform = espressif32@^6.4.0
board = esp32-s3-devkitc-1
framework = arduino
board_build.flash_size = 16MB
board_build.psram_type = opi
board_build.memory_type = opi_opi
board_build.partitions = huge_app.csv
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L
board_build.flash_mode = qio
build_flags = 
    -DCORE_DEBUG_LEVEL=0
    -DCONFIG_ARDUHAL_LOG_DEFAULT_LEVEL=0
    -DCONFIG_ESP32S3_DEFAULT_CPU_FREQ_240=1
    -DCONFIG_ESP32S3_SPIRAM_SUPPORT=1
    -DCONFIG_SPIRAM_USE_CAPS_ALLOC=1
    -DCONFIG_SPIRAM_USE_MALLOC=1
    -DCONFIG_SPIRAM_MALLOC_ALWAYSINTERNAL=0
    -DCONFIG_ESP32S3_WIFI_DYNAMIC_RX_BUFFER_NUM=32
    -DCONFIG_ESP32S3_WIFI_DYNAMIC_TX_BUFFER_NUM=32
    -DCONFIG_I2S_SUPPRESS_DEPRECATE_WARN=1
    -DCONFIG_FREERTOS_HZ=1000
    -DCONFIG_ESP_TASK_WDT_TIMEOUT_S=5
    -Os
    -ffast-math
    -funroll-loops
    -ftree-vectorize
    -fno-exceptions
    -fno-rtti
    -DNDEBUG
lib_deps = 
    adafruit/Adafruit VL53L0X@^1.3.0
    bblanchon/ArduinoJson@^6.21.3
    Wire
    WiFi
    WiFiClientSecure
monitor_speed = 115200
upload_speed = 921600